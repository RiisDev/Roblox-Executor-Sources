#include <iostream>
#include <Windows.h>
#include <string>
#include <thread>
#include <vector>
#include <mutex>

#include "Execution.hpp"
#include "Bypass.hpp"


void launch()
{
	std::thread(Bypass::bypass_thread).detach();

	roblox_state = Addresses::r_lua_newthread(LuaState::get_robloxstate());
	Lua::r_securitylevel(roblox_state, 8);
	Lua::r_sandboxthread(roblox_state);
	
	MAP_INT3();
	AddVectoredExceptionHandler(1, VEH);
	
	Api::registration(roblox_state);

	Execution::execute(roblox_state, "warn('nezy exploit loaded!')");

	std::thread(Execution::pipe).detach();
}


int __stdcall DllMain(void*, int reason, void*)
{
	if (reason == 1)
	{
		std::thread(launch).detach();
	}
	return 1;
}
